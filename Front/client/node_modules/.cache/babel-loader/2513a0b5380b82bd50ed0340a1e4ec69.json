{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\afaf5\\\\OneDrive\\\\\\uBC14\\uD0D5 \\uD654\\uBA74\\\\\\uCD5C\\uC885\\uBCF8\\\\react-BlockChain\\\\Front\\\\client\\\\src\\\\component\\\\ui\\\\Make_Chatting.jsx\",\n    _s = $RefreshSig$();\n\n//#region react\nimport React, { useState, useEffect } from 'react';\nimport Modal from 'react-modal';\nimport io from \"socket.io-client\";\nimport LogText from \"./LogText\"; //#endregion \n//#region mui\n\nimport ButtonGroup from '@mui/material/ButtonGroup';\nimport Button from '@mui/material/Button';\nimport TextField from '@mui/material/TextField';\nimport SendIcon from '@mui/icons-material/Send'; //#endregion \n\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nlet socket;\n\nfunction MakeChatting(props) {\n  _s();\n\n  const ENDPOINT = \"http://localhost:8080\";\n  const {\n    sellername,\n    buyername\n  } = props;\n  const [modalIsOpen, setIsOpen] = useState(false);\n  const [roommax] = useState([0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 113, 14, 15, 16, 17, 18, 19, 20]);\n  const [sendmsg, setSendMsg] = useState(\"\");\n  const [chatlog, setChatlog] = useState([{}]);\n  const [RoomNumber, setRoomNumber] = useState(); // 함수가 실행될때 modal의 상태를 true로 바꿔준다.\n\n  function openModal() {\n    if (sellername === buyername) {\n      alert(\"본인의 매물을 구매할 수 없습니다.\");\n    } else {\n      setIsOpen(true);\n      MakeRoom();\n    }\n  } // 함수가 실행될때 modal의 상태를 false로 바꿔준다.\n\n\n  function closeModal() {\n    setIsOpen(false);\n  }\n\n  useEffect(() => {\n    socket = io(ENDPOINT);\n  }, []);\n  useEffect(() => {\n    socket.on(\"Msg_return\", _ref => {\n      let {\n        buyername,\n        sendmsg\n      } = _ref;\n      setChatlog([...chatlog, {\n        name: buyername,\n        msg: sendmsg\n      }]);\n    });\n\n    if (chatlog.length !== 0 && chatlog.length !== 1) {\n      socket.emit(\"Save_Msg\", {\n        chatlog,\n        RoomNumber\n      });\n    } // eslint-disable-next-line react-hooks/exhaustive-deps\n\n  }, [chatlog]);\n  const roomn = [];\n  let makeroom = [];\n  let roomnumber = 0;\n\n  function MakeRoom() {\n    socket.emit(\"Room_Search\");\n    socket.on(\"Room_Search_Result\", result => {\n      for (let i = 0; i < result.length; i++) {\n        roomn.push(result[i].RoomN);\n      }\n\n      makeroom = roommax.filter(x => !roomn.includes(x));\n\n      if (makeroom.length === 10) {\n        //방이 없을때\n        roomnumber = makeroom[0];\n        setRoomNumber(makeroom[0]);\n        console.log(`방 번호 : ${roomnumber}`);\n        socket.emit(\"Room_Make\", {\n          sellername,\n          buyername,\n          roomnumber\n        }); // eslint-disable-next-line no-loop-func\n\n        socket.on(\"Room_Make_Result\", () => {\n          socket.emit(\"Chatting_Join\", {\n            roomnumber\n          });\n        });\n      } else {\n        //방이 있을때                \n        for (let i = 0; i < result.length; i++) {\n          if (result[i].Sellername === sellername && result[i].Buyername === buyername) {\n            roomnumber = result[i].RoomN;\n            console.log(`방 번호 : ${roomnumber}`);\n            setRoomNumber(roomnumber);\n            socket.emit(\"Chatting_Join\", {\n              roomnumber\n            });\n            setChatlog(result[i].Msg);\n            socket.emit(\"Load_Msg_Makechat\", {\n              roomnumber\n            });\n            socket.on('Return_Load_Msg_Makechat', _ref2 => {\n              let {\n                result\n              } = _ref2;\n              setChatlog(result);\n            });\n            break;\n          } else if (i === result.length - 1) {\n            console.log(\"채팅방 생성!!\");\n            roomnumber = makeroom[0];\n            setRoomNumber(makeroom[0]);\n            socket.emit(\"Room_Make\", {\n              sellername,\n              buyername,\n              roomnumber\n            }); // eslint-disable-next-line no-loop-func\n\n            socket.on(\"Room_Make_Result\", () => {\n              socket.emit(\"Chatting_Join\", {\n                roomnumber\n              });\n            });\n          }\n        }\n      }\n    });\n  }\n\n  function SendMessage() {\n    socket.emit(\"Message_Send\", {\n      buyername,\n      sendmsg,\n      RoomNumber\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(Button, {\n      onClick: () => {\n        openModal();\n      },\n      children: \"CHATTING\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Modal, {\n      isOpen: modalIsOpen,\n      ariaHideApp: false,\n      children: [/*#__PURE__*/_jsxDEV(LogText, {\n        log: chatlog\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(TextField, {\n        margin: \"normal\",\n        required: true,\n        fullWidth: true,\n        id: \"Message\",\n        label: \"Message\",\n        name: \"Message\",\n        autoComplete: \"Message\",\n        autoFocus: true,\n        onChange: e => setSendMsg(e.target.value)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(ButtonGroup, {\n        disableElevation: true,\n        variant: \"contained\",\n        children: [/*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          onClick: () => {\n            closeModal();\n          },\n          children: \"CLOSE\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          variant: \"contained\",\n          endIcon: /*#__PURE__*/_jsxDEV(SendIcon, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 58\n          }, this),\n          onClick: () => {\n            SendMessage();\n          },\n          children: \"SEND\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 134,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 132,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 115,\n    columnNumber: 9\n  }, this);\n}\n\n_s(MakeChatting, \"9qn2aNlvcVxt8tzq8MWACOEG6hA=\");\n\n_c = MakeChatting;\nexport default MakeChatting;\n\nvar _c;\n\n$RefreshReg$(_c, \"MakeChatting\");","map":{"version":3,"names":["React","useState","useEffect","Modal","io","LogText","ButtonGroup","Button","TextField","SendIcon","socket","MakeChatting","props","ENDPOINT","sellername","buyername","modalIsOpen","setIsOpen","roommax","sendmsg","setSendMsg","chatlog","setChatlog","RoomNumber","setRoomNumber","openModal","alert","MakeRoom","closeModal","on","name","msg","length","emit","roomn","makeroom","roomnumber","result","i","push","RoomN","filter","x","includes","console","log","Sellername","Buyername","Msg","SendMessage","e","target","value"],"sources":["C:/Users/afaf5/OneDrive/바탕 화면/최종본/react-BlockChain/Front/client/src/component/ui/Make_Chatting.jsx"],"sourcesContent":["//#region react\nimport React, { useState, useEffect } from 'react';\nimport Modal from 'react-modal';\nimport io from \"socket.io-client\";\nimport LogText from \"./LogText\"\n//#endregion \n\n//#region mui\nimport ButtonGroup from '@mui/material/ButtonGroup';\nimport Button from '@mui/material/Button';\nimport TextField from '@mui/material/TextField';\nimport SendIcon from '@mui/icons-material/Send';\n//#endregion \n\nlet socket;\n\nfunction MakeChatting(props) {\n\n    const ENDPOINT = \"http://localhost:8080\";\n\n    const { sellername, buyername } = props;\n\n    const [modalIsOpen, setIsOpen] = useState(false);\n    const [roommax] = useState([0, 1, 2, 3, 4, 5, 6, 7, 8, 9,10,11,12,113,14,15,16,17,18,19,20]);\n    const [sendmsg, setSendMsg] = useState(\"\");\n    const [chatlog, setChatlog] = useState([{}]);\n    const [RoomNumber, setRoomNumber] = useState();\n\n    // 함수가 실행될때 modal의 상태를 true로 바꿔준다.\n    function openModal() {\n        if (sellername === buyername) {\n            alert(\"본인의 매물을 구매할 수 없습니다.\")\n        }\n        else {\n            setIsOpen(true);\n            MakeRoom();\n        }\n    }\n\n    // 함수가 실행될때 modal의 상태를 false로 바꿔준다.\n    function closeModal() {\n        setIsOpen(false);\n    }\n\n    useEffect(() => {\n        socket = io(ENDPOINT);\n    }, []);\n\n    useEffect(() => {\n        socket.on(\"Msg_return\", ({ buyername, sendmsg }) => {\n            setChatlog([...chatlog, { name: buyername, msg: sendmsg }]);\n        })\n        if(chatlog.length !== 0 && chatlog.length !== 1)\n        {\n            socket.emit(\"Save_Msg\",({chatlog, RoomNumber}));\n        }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [chatlog])\n\n    const roomn = []\n    let makeroom = []\n    let roomnumber = 0;\n\n    function MakeRoom() {\n        socket.emit(\"Room_Search\");\n        socket.on(\"Room_Search_Result\", (result) => {\n            for (let i = 0; i < result.length; i++) {\n                roomn.push(result[i].RoomN);\n            }\n            makeroom = roommax.filter(x => !roomn.includes(x))\n            if (makeroom.length === 10) {  //방이 없을때\n                roomnumber = makeroom[0];\n                setRoomNumber(makeroom[0]);\n                console.log(`방 번호 : ${roomnumber}`);\n                socket.emit(\"Room_Make\", { sellername, buyername, roomnumber });\n                // eslint-disable-next-line no-loop-func\n                socket.on(\"Room_Make_Result\", () => {\n                    socket.emit(\"Chatting_Join\", { roomnumber });\n                })\n            }\n            else {  //방이 있을때                \n                for (let i = 0; i < result.length; i++) {\n                    if (result[i].Sellername === sellername && result[i].Buyername === buyername) {\n                        roomnumber = result[i].RoomN;\n                        console.log(`방 번호 : ${roomnumber}`);\n                        setRoomNumber(roomnumber);                      \n                        socket.emit(\"Chatting_Join\", { roomnumber });\n                        setChatlog(result[i].Msg);\n                        socket.emit(\"Load_Msg_Makechat\", { roomnumber });\n                        socket.on('Return_Load_Msg_Makechat', ({ result }) => {\n                            setChatlog(result);\n                        })\n                        break\n                    }\n                    else if (i === result.length - 1) {\n                        console.log(\"채팅방 생성!!\")\n                        roomnumber = makeroom[0]\n                        setRoomNumber(makeroom[0])\n                        socket.emit(\"Room_Make\", { sellername, buyername, roomnumber });\n                        // eslint-disable-next-line no-loop-func\n                        socket.on(\"Room_Make_Result\", () => {\n                            socket.emit(\"Chatting_Join\", { roomnumber });\n                        })\n                    }\n                }\n            }\n        })\n    }\n\n    function SendMessage() {\n        socket.emit(\"Message_Send\", { buyername, sendmsg, RoomNumber });\n    }\n\n    return (\n        <div>\n            <Button onClick={() => {\n                openModal()\n            }}>CHATTING</Button>\n            <Modal isOpen={modalIsOpen} ariaHideApp={false}>\n                <LogText log={chatlog} ></LogText>\n                <TextField\n                    margin='normal'\n                    required\n                    fullWidth\n                    id=\"Message\"\n                    label=\"Message\"\n                    name=\"Message\"\n                    autoComplete=\"Message\"\n                    autoFocus\n                    onChange={(e) => setSendMsg(e.target.value)}\n                />\n                <ButtonGroup disableElevation variant=\"contained\">\n                    <Button variant=\"contained\" onClick={() => { closeModal() }}>CLOSE</Button>\n                    <Button variant=\"contained\" endIcon={<SendIcon />} onClick={() => { SendMessage() }} >SEND</Button>\n                </ButtonGroup>\n            </Modal>\n        </div>\n    );\n}\n\nexport default MakeChatting;"],"mappings":";;;AAAA;AACA,OAAOA,KAAP,IAAgBC,QAAhB,EAA0BC,SAA1B,QAA2C,OAA3C;AACA,OAAOC,KAAP,MAAkB,aAAlB;AACA,OAAOC,EAAP,MAAe,kBAAf;AACA,OAAOC,OAAP,MAAoB,WAApB,C,CACA;AAEA;;AACA,OAAOC,WAAP,MAAwB,2BAAxB;AACA,OAAOC,MAAP,MAAmB,sBAAnB;AACA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,QAAP,MAAqB,0BAArB,C,CACA;;;AAEA,IAAIC,MAAJ;;AAEA,SAASC,YAAT,CAAsBC,KAAtB,EAA6B;EAAA;;EAEzB,MAAMC,QAAQ,GAAG,uBAAjB;EAEA,MAAM;IAAEC,UAAF;IAAcC;EAAd,IAA4BH,KAAlC;EAEA,MAAM,CAACI,WAAD,EAAcC,SAAd,IAA2BhB,QAAQ,CAAC,KAAD,CAAzC;EACA,MAAM,CAACiB,OAAD,IAAYjB,QAAQ,CAAC,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,EAAmB,CAAnB,EAAsB,CAAtB,EAAyB,CAAzB,EAA4B,CAA5B,EAA8B,EAA9B,EAAiC,EAAjC,EAAoC,EAApC,EAAuC,GAAvC,EAA2C,EAA3C,EAA8C,EAA9C,EAAiD,EAAjD,EAAoD,EAApD,EAAuD,EAAvD,EAA0D,EAA1D,EAA6D,EAA7D,CAAD,CAA1B;EACA,MAAM,CAACkB,OAAD,EAAUC,UAAV,IAAwBnB,QAAQ,CAAC,EAAD,CAAtC;EACA,MAAM,CAACoB,OAAD,EAAUC,UAAV,IAAwBrB,QAAQ,CAAC,CAAC,EAAD,CAAD,CAAtC;EACA,MAAM,CAACsB,UAAD,EAAaC,aAAb,IAA8BvB,QAAQ,EAA5C,CAVyB,CAYzB;;EACA,SAASwB,SAAT,GAAqB;IACjB,IAAIX,UAAU,KAAKC,SAAnB,EAA8B;MAC1BW,KAAK,CAAC,qBAAD,CAAL;IACH,CAFD,MAGK;MACDT,SAAS,CAAC,IAAD,CAAT;MACAU,QAAQ;IACX;EACJ,CArBwB,CAuBzB;;;EACA,SAASC,UAAT,GAAsB;IAClBX,SAAS,CAAC,KAAD,CAAT;EACH;;EAEDf,SAAS,CAAC,MAAM;IACZQ,MAAM,GAAGN,EAAE,CAACS,QAAD,CAAX;EACH,CAFQ,EAEN,EAFM,CAAT;EAIAX,SAAS,CAAC,MAAM;IACZQ,MAAM,CAACmB,EAAP,CAAU,YAAV,EAAwB,QAA4B;MAAA,IAA3B;QAAEd,SAAF;QAAaI;MAAb,CAA2B;MAChDG,UAAU,CAAC,CAAC,GAAGD,OAAJ,EAAa;QAAES,IAAI,EAAEf,SAAR;QAAmBgB,GAAG,EAAEZ;MAAxB,CAAb,CAAD,CAAV;IACH,CAFD;;IAGA,IAAGE,OAAO,CAACW,MAAR,KAAmB,CAAnB,IAAwBX,OAAO,CAACW,MAAR,KAAmB,CAA9C,EACA;MACItB,MAAM,CAACuB,IAAP,CAAY,UAAZ,EAAwB;QAACZ,OAAD;QAAUE;MAAV,CAAxB;IACH,CAPW,CAQhB;;EACC,CATQ,EASN,CAACF,OAAD,CATM,CAAT;EAWA,MAAMa,KAAK,GAAG,EAAd;EACA,IAAIC,QAAQ,GAAG,EAAf;EACA,IAAIC,UAAU,GAAG,CAAjB;;EAEA,SAAST,QAAT,GAAoB;IAChBjB,MAAM,CAACuB,IAAP,CAAY,aAAZ;IACAvB,MAAM,CAACmB,EAAP,CAAU,oBAAV,EAAiCQ,MAAD,IAAY;MACxC,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACL,MAA3B,EAAmCM,CAAC,EAApC,EAAwC;QACpCJ,KAAK,CAACK,IAAN,CAAWF,MAAM,CAACC,CAAD,CAAN,CAAUE,KAArB;MACH;;MACDL,QAAQ,GAAGjB,OAAO,CAACuB,MAAR,CAAeC,CAAC,IAAI,CAACR,KAAK,CAACS,QAAN,CAAeD,CAAf,CAArB,CAAX;;MACA,IAAIP,QAAQ,CAACH,MAAT,KAAoB,EAAxB,EAA4B;QAAG;QAC3BI,UAAU,GAAGD,QAAQ,CAAC,CAAD,CAArB;QACAX,aAAa,CAACW,QAAQ,CAAC,CAAD,CAAT,CAAb;QACAS,OAAO,CAACC,GAAR,CAAa,UAAST,UAAW,EAAjC;QACA1B,MAAM,CAACuB,IAAP,CAAY,WAAZ,EAAyB;UAAEnB,UAAF;UAAcC,SAAd;UAAyBqB;QAAzB,CAAzB,EAJwB,CAKxB;;QACA1B,MAAM,CAACmB,EAAP,CAAU,kBAAV,EAA8B,MAAM;UAChCnB,MAAM,CAACuB,IAAP,CAAY,eAAZ,EAA6B;YAAEG;UAAF,CAA7B;QACH,CAFD;MAGH,CATD,MAUK;QAAG;QACJ,KAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,MAAM,CAACL,MAA3B,EAAmCM,CAAC,EAApC,EAAwC;UACpC,IAAID,MAAM,CAACC,CAAD,CAAN,CAAUQ,UAAV,KAAyBhC,UAAzB,IAAuCuB,MAAM,CAACC,CAAD,CAAN,CAAUS,SAAV,KAAwBhC,SAAnE,EAA8E;YAC1EqB,UAAU,GAAGC,MAAM,CAACC,CAAD,CAAN,CAAUE,KAAvB;YACAI,OAAO,CAACC,GAAR,CAAa,UAAST,UAAW,EAAjC;YACAZ,aAAa,CAACY,UAAD,CAAb;YACA1B,MAAM,CAACuB,IAAP,CAAY,eAAZ,EAA6B;cAAEG;YAAF,CAA7B;YACAd,UAAU,CAACe,MAAM,CAACC,CAAD,CAAN,CAAUU,GAAX,CAAV;YACAtC,MAAM,CAACuB,IAAP,CAAY,mBAAZ,EAAiC;cAAEG;YAAF,CAAjC;YACA1B,MAAM,CAACmB,EAAP,CAAU,0BAAV,EAAsC,SAAgB;cAAA,IAAf;gBAAEQ;cAAF,CAAe;cAClDf,UAAU,CAACe,MAAD,CAAV;YACH,CAFD;YAGA;UACH,CAXD,MAYK,IAAIC,CAAC,KAAKD,MAAM,CAACL,MAAP,GAAgB,CAA1B,EAA6B;YAC9BY,OAAO,CAACC,GAAR,CAAY,UAAZ;YACAT,UAAU,GAAGD,QAAQ,CAAC,CAAD,CAArB;YACAX,aAAa,CAACW,QAAQ,CAAC,CAAD,CAAT,CAAb;YACAzB,MAAM,CAACuB,IAAP,CAAY,WAAZ,EAAyB;cAAEnB,UAAF;cAAcC,SAAd;cAAyBqB;YAAzB,CAAzB,EAJ8B,CAK9B;;YACA1B,MAAM,CAACmB,EAAP,CAAU,kBAAV,EAA8B,MAAM;cAChCnB,MAAM,CAACuB,IAAP,CAAY,eAAZ,EAA6B;gBAAEG;cAAF,CAA7B;YACH,CAFD;UAGH;QACJ;MACJ;IACJ,CAzCD;EA0CH;;EAED,SAASa,WAAT,GAAuB;IACnBvC,MAAM,CAACuB,IAAP,CAAY,cAAZ,EAA4B;MAAElB,SAAF;MAAaI,OAAb;MAAsBI;IAAtB,CAA5B;EACH;;EAED,oBACI;IAAA,wBACI,QAAC,MAAD;MAAQ,OAAO,EAAE,MAAM;QACnBE,SAAS;MACZ,CAFD;MAAA;IAAA;MAAA;MAAA;MAAA;IAAA,QADJ,eAII,QAAC,KAAD;MAAO,MAAM,EAAET,WAAf;MAA4B,WAAW,EAAE,KAAzC;MAAA,wBACI,QAAC,OAAD;QAAS,GAAG,EAAEK;MAAd;QAAA;QAAA;QAAA;MAAA,QADJ,eAEI,QAAC,SAAD;QACI,MAAM,EAAC,QADX;QAEI,QAAQ,MAFZ;QAGI,SAAS,MAHb;QAII,EAAE,EAAC,SAJP;QAKI,KAAK,EAAC,SALV;QAMI,IAAI,EAAC,SANT;QAOI,YAAY,EAAC,SAPjB;QAQI,SAAS,MARb;QASI,QAAQ,EAAG6B,CAAD,IAAO9B,UAAU,CAAC8B,CAAC,CAACC,MAAF,CAASC,KAAV;MAT/B;QAAA;QAAA;QAAA;MAAA,QAFJ,eAaI,QAAC,WAAD;QAAa,gBAAgB,MAA7B;QAA8B,OAAO,EAAC,WAAtC;QAAA,wBACI,QAAC,MAAD;UAAQ,OAAO,EAAC,WAAhB;UAA4B,OAAO,EAAE,MAAM;YAAExB,UAAU;UAAI,CAA3D;UAAA;QAAA;UAAA;UAAA;UAAA;QAAA,QADJ,eAEI,QAAC,MAAD;UAAQ,OAAO,EAAC,WAAhB;UAA4B,OAAO,eAAE,QAAC,QAAD;YAAA;YAAA;YAAA;UAAA,QAArC;UAAmD,OAAO,EAAE,MAAM;YAAEqB,WAAW;UAAI,CAAnF;UAAA;QAAA;UAAA;UAAA;UAAA;QAAA,QAFJ;MAAA;QAAA;QAAA;QAAA;MAAA,QAbJ;IAAA;MAAA;MAAA;MAAA;IAAA,QAJJ;EAAA;IAAA;IAAA;IAAA;EAAA,QADJ;AAyBH;;GA1HQtC,Y;;KAAAA,Y;AA4HT,eAAeA,YAAf"},"metadata":{},"sourceType":"module"}